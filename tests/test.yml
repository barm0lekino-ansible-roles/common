#---
- name: COMMON
  tags:
    - common
  hosts: all
  gather_facts: no # нужно отключить предварительный сбор сведений, т.к. сначала дожны отработать задачи pre_tasks
  #remote_user: ak
  #become_user: root
  become: yes

  pre_tasks:
    - name: Include extra vars
      include_vars:
        file: /home/ak/.ssh/ansible_linux_pwd
        name: ext_vars

    - name: Set facts
      set_fact:
        become_user: "{{ ext_vars.SUDO_USER }}"
        ansible_become_pass: "{{ ext_vars.SUDO_PASSWORD }}"

    - debug: msg="become_user = {{ become_user }}, ansible_become_pass = {{ ansible_become_pass }}"

  vars:
    config_users:
      - ubuntu

  roles:
    - barm0leykin.common
