---
  - name: Check if EPEL repo is already configured.
    stat: path={{ epel_repofile_path }}
    register: epel_repofile_result
    when: install_packages == true

  - name: Install EPEL repo.
    yum:
      name: "{{ epel_repo_url }}"
      state: present
    register: result
    when: not epel_repofile_result.stat.exists and install_packages == true

  - name: Import EPEL GPG key.
    rpm_key:
      key: "{{ epel_repo_gpg_key_url }}"
      state: present
    when: not epel_repofile_result.stat.exists and install_packages == true

  - name: install RHEL/CentOS packages
    package:
      pkg: "{{ item }}"
      update_cache: yes
    with_items:
      - "{{ rh_packages }}"
    when: install_packages == true
    tags: ["common", "packages"]
